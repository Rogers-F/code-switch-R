# ADR-0002: MITM 监听端口与转发策略（443 vs 8443 + 端口转发）

**状态**：Accepted
**日期**：2026-01-13
**决策日期**：2026-01-13  

---

## 背景

要通过 Hosts 把目标域名指向 `127.0.0.1` 并拦截 HTTPS，客户端会默认访问 443 端口。

但在 macOS/Linux 上，绑定 443 往往需要管理员/特权能力；如果强制要求“以管理员运行整个应用”，用户体验与安全边界会变差。

---

## 选项

### 方案 A：直接监听 443

**优点**：

- 实现直观，链路最短

**缺点**：

- macOS/Linux 需要提权运行（或额外能力），失败概率高
- 需要更严格的安全评估（长期特权进程）

### 方案 B：监听高位端口（如 8443）+ 系统端口转发（推荐）

**优点**：

- 应用主体可保持非特权运行
- 仅在需要时对“端口转发规则”提权，符合最小权限原则

**缺点**：

- 端口转发在不同 OS 上差异大（命令、持久化、回滚）
- 需要更完善的状态检查与自动清理

---

## 决策（待确认）

倾向选择 **方案 B**，并提供可配置项：

- Windows：优先尝试直接监听 443；失败时回退到 8443 + 端口转发
- macOS/Linux：默认 8443 + 端口转发

---

## 影响

- P3 必须实现端口转发的 enable/disable/status，并提供可靠回滚
- P5 验证矩阵必须覆盖端口转发的异常场景（取消提权/规则残留）

